<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CineMatch - Movie & TV Recommendations</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      :root {
        --primary: #6366f1;
        --primary-dark: #4f46e5;
        --secondary: #ec4899;
        --dark: #0f172a;
        --dark-light: #1e293b;
        --gray: #64748b;
        --light: #f1f5f9;
        --success: #10b981;
        --warning: #f59e0b;
        --danger: #ef4444;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, sans-serif;
        background: var(--dark);
        color: var(--light);
        overflow-x: hidden;
      }

      /* Animations */
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes slideIn {
        from {
          transform: translateX(-100%);
        }
        to {
          transform: translateX(0);
        }
      }

      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
      }

      /* Header */
      .header {
        background: linear-gradient(
          135deg,
          var(--dark-light) 0%,
          var(--dark) 100%
        );
        padding: 1.5rem 2rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        position: sticky;
        top: 0;
        z-index: 100;
        backdrop-filter: blur(10px);
        animation: slideIn 0.5s ease-out;
      }

      .header-content {
        max-width: 1400px;
        margin: 0 auto;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 1rem;
      }

      .logo {
        font-size: 2rem;
        font-weight: 800;
        background: linear-gradient(
          135deg,
          var(--primary) 0%,
          var(--secondary) 100%
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        animation: pulse 2s infinite;
      }

      /* Navigation Tabs */
      .nav-tabs {
        display: flex;
        gap: 1rem;
        background: var(--dark-light);
        padding: 0.5rem;
        border-radius: 50px;
        animation: fadeIn 0.6s ease-out 0.2s both;
      }

      .nav-tab {
        padding: 0.75rem 1.5rem;
        border-radius: 50px;
        background: transparent;
        border: none;
        color: var(--gray);
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        font-size: 0.95rem;
        font-weight: 500;
      }

      .nav-tab:hover {
        color: var(--light);
        transform: translateY(-2px);
      }

      .nav-tab.active {
        background: var(--primary);
        color: white;
        box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
      }

      /* Main Container */
      .container {
        max-width: 1400px;
        margin: 2rem auto;
        padding: 0 2rem;
      }

      /* Filters Section */
      .filters-section {
        background: var(--dark-light);
        border-radius: 20px;
        padding: 2rem;
        margin-bottom: 2rem;
        animation: fadeIn 0.6s ease-out 0.3s both;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      }

      .filters-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1.5rem;
        margin-bottom: 1.5rem;
      }

      .filter-group {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
      }

      .filter-label {
        font-size: 0.875rem;
        color: var(--gray);
        font-weight: 500;
      }

      .filter-input,
      .filter-select {
        padding: 0.75rem 1rem;
        border-radius: 10px;
        border: 2px solid transparent;
        background: var(--dark);
        color: var(--light);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        font-size: 0.95rem;
      }

      .filter-input:focus,
      .filter-select:focus {
        outline: none;
        border-color: var(--primary);
        transform: scale(1.02);
        box-shadow: 0 0 20px rgba(99, 102, 241, 0.2);
      }

      /* Buttons */
      .btn {
        padding: 0.75rem 2rem;
        border-radius: 50px;
        border: none;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        font-size: 1rem;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
      }

      .btn-primary {
        background: linear-gradient(
          135deg,
          var(--primary) 0%,
          var(--primary-dark) 100%
        );
        color: white;
        box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
      }

      .btn-primary:hover {
        transform: translateY(-3px) scale(1.05);
        box-shadow: 0 6px 25px rgba(99, 102, 241, 0.4);
      }

      .btn-secondary {
        background: var(--secondary);
        color: white;
        box-shadow: 0 4px 15px rgba(236, 72, 153, 0.3);
      }

      .btn-secondary:hover {
        transform: translateY(-3px) scale(1.05);
        box-shadow: 0 6px 25px rgba(236, 72, 153, 0.4);
      }

      .btn-group {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
        justify-content: center;
      }

      /* Movie Grid */
      .movies-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 2rem;
        animation: fadeIn 0.6s ease-out 0.4s both;
      }

      .movie-card {
        background: var(--dark-light);
        border-radius: 15px;
        overflow: hidden;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        cursor: pointer;
        position: relative;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      }

      .movie-card:hover {
        transform: translateY(-10px) scale(1.05);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
      }

      .movie-poster {
        width: 100%;
        height: 300px;
        object-fit: cover;
        transition: transform 0.3s ease;
      }

      .movie-card:hover .movie-poster {
        transform: scale(1.1);
      }

      .movie-info {
        padding: 1rem;
      }

      .movie-title {
        font-size: 1rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }

      .movie-meta {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 0.875rem;
        color: var(--gray);
      }

      .rating {
        display: flex;
        align-items: center;
        gap: 0.25rem;
        color: var(--warning);
      }

      /* Watched Library */
      .watched-section {
        background: var(--dark-light);
        border-radius: 20px;
        padding: 2rem;
        margin-bottom: 2rem;
        animation: fadeIn 0.6s ease-out 0.3s both;
      }

      .watched-list {
        display: flex;
        gap: 1rem;
        overflow-x: auto;
        padding: 1rem 0;
        scrollbar-width: thin;
        scrollbar-color: var(--primary) var(--dark);
      }

      .watched-item {
        flex-shrink: 0;
        width: 120px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .watched-item img {
        width: 100%;
        height: 180px;
        object-fit: cover;
        border-radius: 10px;
        margin-bottom: 0.5rem;
        transition: transform 0.3s ease;
      }

      .watched-item:hover img {
        transform: scale(1.1);
      }

      .remove-btn {
        background: var(--danger);
        color: white;
        border: none;
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        font-size: 0.75rem;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .remove-btn:hover {
        background: #dc2626;
        transform: scale(1.1);
      }

      /* Loading Spinner */
      .loading {
        display: none;
        text-align: center;
        padding: 3rem;
      }

      .loading.active {
        display: block;
      }

      .spinner {
        width: 50px;
        height: 50px;
        margin: 0 auto;
        border: 4px solid var(--dark-light);
        border-top-color: var(--primary);
        border-radius: 50%;
        animation: spin 1s cubic-bezier(0.68, -0.55, 0.265, 1.55) infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      /* Modal */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        z-index: 1000;
        animation: fadeIn 0.3s ease;
      }

      .modal.active {
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .modal-content {
        background: var(--dark-light);
        border-radius: 20px;
        padding: 2rem;
        max-width: 600px;
        width: 90%;
        max-height: 90vh;
        overflow-y: auto;
        animation: slideIn 0.3s ease;
      }

      .modal-close {
        float: right;
        font-size: 2rem;
        cursor: pointer;
        color: var(--gray);
        transition: color 0.3s ease;
      }

      .modal-close:hover {
        color: var(--light);
      }

      /* Responsive */
      @media (max-width: 768px) {
        .header-content {
          flex-direction: column;
        }

        .filters-grid {
          grid-template-columns: 1fr;
        }

        .movies-grid {
          grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
          gap: 1rem;
        }

        .movie-poster {
          height: 225px;
        }
      }

      /* API Key Notice */
      .api-notice {
        background: var(--warning);
        color: var(--dark);
        padding: 1rem;
        border-radius: 10px;
        margin-bottom: 2rem;
        text-align: center;
        font-weight: 500;
      }

      .api-notice a {
        color: var(--dark);
        text-decoration: underline;
      }
    </style>
  </head>
  <body>
    <header class="header">
      <div class="header-content">
        <h1 class="logo">CineMatch</h1>
        <nav class="nav-tabs">
          <button class="nav-tab active" data-tab="discover">Discover</button>
          <button class="nav-tab" data-tab="library">My Library</button>
          <button class="nav-tab" data-tab="recommendations">For You</button>
        </nav>
      </div>
    </header>

    <div class="container">
      <!-- Discover Tab -->
      <div id="discover" class="tab-content">
        <div class="filters-section">
          <h2 style="margin-bottom: 1.5rem">Filter & Discover</h2>
          <div class="filters-grid">
            <div class="filter-group">
              <label class="filter-label">Type</label>
              <select class="filter-select" id="mediaType">
                <option value="movie">Movies</option>
                <option value="tv">TV Shows</option>
              </select>
            </div>
            <div class="filter-group">
              <label class="filter-label">Genre</label>
              <select class="filter-select" id="genre">
                <option value="">All Genres</option>
                <option value="28">Action</option>
                <option value="12">Adventure</option>
                <option value="16">Animation</option>
                <option value="35">Comedy</option>
                <option value="80">Crime</option>
                <option value="99">Documentary</option>
                <option value="18">Drama</option>
                <option value="10751">Family</option>
                <option value="14">Fantasy</option>
                <option value="36">History</option>
                <option value="27">Horror</option>
                <option value="10402">Music</option>
                <option value="9648">Mystery</option>
                <option value="10749">Romance</option>
                <option value="878">Science Fiction</option>
                <option value="10770">TV Movie</option>
                <option value="53">Thriller</option>
                <option value="10752">War</option>
                <option value="37">Western</option>
              </select>
            </div>
            <div class="filter-group">
              <label class="filter-label">Year</label>
              <select class="filter-select" id="year">
                <option value="">All Years</option>
                <option value="2024">2024</option>
                <option value="2023">2023</option>
                <option value="2022">2022</option>
                <option value="2021">2021</option>
                <option value="2020">2020</option>
                <option value="2010-2019">2010s</option>
                <option value="2000-2009">2000s</option>
                <option value="1990-1999">1990s</option>
                <option value="1980-1989">1980s</option>
              </select>
            </div>
            <div class="filter-group">
              <label class="filter-label">Sort By</label>
              <select class="filter-select" id="sortBy">
                <option value="popularity.desc">Most Popular</option>
                <option value="vote_average.desc">Highest Rated</option>
                <option value="release_date.desc">Newest First</option>
                <option value="revenue.desc">Highest Revenue</option>
              </select>
            </div>
            <div class="filter-group">
              <label class="filter-label">Min Rating</label>
              <input
                type="range"
                class="filter-input"
                id="minRating"
                min="0"
                max="10"
                step="0.5"
                value="0" />
              <span id="ratingValue">0</span>
            </div>
          </div>
          <div class="btn-group">
            <button class="btn btn-primary" onclick="applyFilters()">
              <span>🔍</span> Search
            </button>
            <button class="btn btn-secondary" onclick="getRandomSuggestion()">
              <span>🎲</span> Random Pick
            </button>
          </div>
        </div>

        <div class="loading" id="loading">
          <div class="spinner"></div>
          <p style="margin-top: 1rem">Finding great content for you...</p>
        </div>

        <div class="movies-grid" id="moviesGrid"></div>
      </div>

      <!-- Library Tab -->
      <div id="library" class="tab-content" style="display: none">
        <div class="watched-section">
          <h2 style="margin-bottom: 1.5rem">My Watched Library</h2>
          <div class="watched-list" id="watchedList"></div>
          <p
            id="emptyLibrary"
            style="text-align: center; color: var(--gray); margin-top: 2rem">
            Your library is empty. Start adding movies from the Discover tab!
          </p>
        </div>
      </div>

      <!-- Recommendations Tab -->
      <div id="recommendations" class="tab-content" style="display: none">
        <div class="filters-section">
          <h2 style="margin-bottom: 1.5rem">Personalized Recommendations</h2>
          <p style="color: var(--gray); margin-bottom: 1.5rem">
            Based on your watched history, we think you'll love these:
          </p>
          <div class="btn-group">
            <button
              class="btn btn-primary"
              onclick="getPersonalizedRecommendations()">
              <span>✨</span> Get Recommendations
            </button>
          </div>
        </div>
        <div class="loading" id="recLoading">
          <div class="spinner"></div>
          <p style="margin-top: 1rem">Analyzing your preferences...</p>
        </div>
        <div class="movies-grid" id="recommendationsGrid"></div>
      </div>
    </div>

    <!-- Movie Details Modal -->
    <div class="modal" id="movieModal">
      <div class="modal-content">
        <span class="modal-close" onclick="closeModal()">&times;</span>
        <div id="modalContent"></div>
      </div>
    </div>

    <script>
      // IMPORTANT: Replace with your TMDB API key
      const API_KEY = "ebf5aec1a4d9dc75d8a30a7429fa6005";
      const BASE_URL = "https://api.themoviedb.org/3";
      const IMG_BASE_URL = "https://image.tmdb.org/t/p/w500";

      // State management
      let watchedMovies = JSON.parse(
        localStorage.getItem("watchedMovies") || "[]"
      );
      let currentTab = "discover";

      // Tab switching
      document.querySelectorAll(".nav-tab").forEach((tab) => {
        tab.addEventListener("click", (e) => {
          const tabName = e.target.dataset.tab;
          switchTab(tabName);
        });
      });

      function switchTab(tabName) {
        currentTab = tabName;
        document
          .querySelectorAll(".nav-tab")
          .forEach((t) => t.classList.remove("active"));
        document
          .querySelector(`[data-tab="${tabName}"]`)
          .classList.add("active");

        document.querySelectorAll(".tab-content").forEach((content) => {
          content.style.display = "none";
        });
        document.getElementById(tabName).style.display = "block";

        if (tabName === "library") {
          updateWatchedList();
        }
      }

      // Rating slider
      const ratingSlider = document.getElementById("minRating");
      const ratingValue = document.getElementById("ratingValue");
      ratingSlider.addEventListener("input", (e) => {
        ratingValue.textContent = e.target.value;
      });

      // Fetch movies with filters
      async function applyFilters() {
        const mediaType = document.getElementById("mediaType").value;
        const genre = document.getElementById("genre").value;
        const year = document.getElementById("year").value;
        const sortBy = document.getElementById("sortBy").value;
        const minRating = document.getElementById("minRating").value;

        let url = `${BASE_URL}/discover/${mediaType}?api_key=${API_KEY}&sort_by=${sortBy}&vote_average.gte=${minRating}&vote_count.gte=100`;

        if (genre) url += `&with_genres=${genre}`;

        if (year) {
          if (year.includes("-")) {
            const [start, end] = year.split("-");
            url += `&primary_release_date.gte=${start}-01-01&primary_release_date.lte=${end}-12-31`;
          } else {
            url += `&primary_release_year=${year}`;
          }
        }

        showLoading("loading");
        try {
          const response = await fetch(url);
          const data = await response.json();
          displayMovies(data.results, "moviesGrid");
        } catch (error) {
          console.error("Error fetching movies:", error);
        }
        hideLoading("loading");
      }

      // Get random suggestion
      async function getRandomSuggestion() {
        const randomPage = Math.floor(Math.random() * 10) + 1;
        const mediaType = document.getElementById("mediaType").value;

        showLoading("loading");
        try {
          const response = await fetch(
            `${BASE_URL}/discover/${mediaType}?api_key=${API_KEY}&page=${randomPage}`
          );
          const data = await response.json();
          const randomIndex = Math.floor(Math.random() * data.results.length);
          displayMovies([data.results[randomIndex]], "moviesGrid");
        } catch (error) {
          console.error("Error fetching random movie:", error);
        }
        hideLoading("loading");
      }

      // Get personalized recommendations
      async function getPersonalizedRecommendations() {
        if (watchedMovies.length === 0) {
          document.getElementById("recommendationsGrid").innerHTML =
            '<p style="text-align: center; color: var(--gray); grid-column: 1/-1;">Add some movies to your library first!</p>';
          return;
        }

        showLoading("recLoading");
        const recommendations = new Set();

        // Get recommendations based on watched movies
        for (const movie of watchedMovies.slice(-5)) {
          try {
            const response = await fetch(
              `${BASE_URL}/movie/${movie.id}/recommendations?api_key=${API_KEY}`
            );
            const data = await response.json();
            data.results
              .slice(0, 4)
              .forEach((rec) => recommendations.add(JSON.stringify(rec)));
          } catch (error) {
            console.error("Error fetching recommendations:", error);
          }
        }

        const uniqueRecommendations = Array.from(recommendations).map((r) =>
          JSON.parse(r)
        );
        displayMovies(uniqueRecommendations, "recommendationsGrid");
        hideLoading("recLoading");
      }

      // Display movies
      function displayMovies(movies, containerId) {
        const container = document.getElementById(containerId);

        if (movies.length === 0) {
          container.innerHTML =
            '<p style="text-align: center; color: var(--gray); grid-column: 1/-1;">No results found. Try different filters!</p>';
          return;
        }

        container.innerHTML = movies
          .map(
            (movie) => `
                <div class="movie-card" onclick="showMovieDetails(${
                  movie.id
                }, '${movie.title || movie.name}')">
                    <img class="movie-poster" 
                         src="${
                           movie.poster_path
                             ? IMG_BASE_URL + movie.poster_path
                             : "https://via.placeholder.com/500x750?text=No+Poster"
                         }" 
                         alt="${movie.title || movie.name}">
                    <div class="movie-info">
                        <h3 class="movie-title">${
                          movie.title || movie.name
                        }</h3>
                        <div class="movie-meta">
                            <span>${
                              movie.release_date
                                ? movie.release_date.split("-")[0]
                                : "N/A"
                            }</span>
                            <span class="rating">⭐ ${movie.vote_average.toFixed(
                              1
                            )}</span>
                        </div>
                    </div>
                </div>
            `
          )
          .join("");
      }

      // Show movie details modal
      async function showMovieDetails(movieId, movieTitle) {
        const modal = document.getElementById("movieModal");
        const modalContent = document.getElementById("modalContent");

        modal.classList.add("active");
        modalContent.innerHTML =
          '<div class="loading active"><div class="spinner"></div></div>';

        try {
          const response = await fetch(
            `${BASE_URL}/movie/${movieId}?api_key=${API_KEY}`
          );
          const movie = await response.json();

          const isWatched = watchedMovies.some((m) => m.id === movieId);

          modalContent.innerHTML = `
                    <div style="display: flex; gap: 2rem; flex-wrap: wrap;">
                        <img src="${
                          movie.poster_path
                            ? IMG_BASE_URL + movie.poster_path
                            : "https://via.placeholder.com/300x450"
                        }" 
                             alt="${movie.title}" 
                             style="width: 200px; border-radius: 10px;">
                        <div style="flex: 1;">
                            <h2>${movie.title}</h2>
                            <p style="color: var(--gray); margin: 1rem 0;">${
                              movie.tagline || ""
                            }</p>
                            <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
                                <span class="rating">⭐ ${movie.vote_average.toFixed(
                                  1
                                )}</span>
                                <span>${movie.runtime} min</span>
                                <span>${movie.release_date.split("-")[0]}</span>
                            </div>
                            <p style="line-height: 1.6; margin-bottom: 1.5rem;">${
                              movie.overview
                            }</p>
                            <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; margin-bottom: 1.5rem;">
                                ${movie.genres
                                  .map(
                                    (g) =>
                                      `<span style="background: var(--primary); padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.875rem;">${g.name}</span>`
                                  )
                                  .join("")}
                            </div>
                            <button class="btn ${
                              isWatched ? "btn-secondary" : "btn-primary"
                            }" 
                                    onclick="toggleWatched(${movieId}, '${movie.title.replace(
            /'/g,
            "\\'"
          )}', '${movie.poster_path}')">
                                ${isWatched ? "✓ Watched" : "+ Add to Library"}
                            </button>
                        </div>
                    </div>
                `;
        } catch (error) {
          modalContent.innerHTML = "<p>Error loading movie details.</p>";
        }
      }

      // Close modal
      function closeModal() {
        document.getElementById("movieModal").classList.remove("active");
      }

      // Toggle watched status
      function toggleWatched(movieId, title, posterPath) {
        const index = watchedMovies.findIndex((m) => m.id === movieId);

        if (index > -1) {
          watchedMovies.splice(index, 1);
        } else {
          watchedMovies.push({ id: movieId, title, poster_path: posterPath });
        }

        localStorage.setItem("watchedMovies", JSON.stringify(watchedMovies));
        showMovieDetails(movieId, title); // Refresh modal
      }

      // Update watched list
      function updateWatchedList() {
        const watchedList = document.getElementById("watchedList");
        const emptyMessage = document.getElementById("emptyLibrary");

        if (watchedMovies.length === 0) {
          watchedList.innerHTML = "";
          emptyMessage.style.display = "block";
          return;
        }

        emptyMessage.style.display = "none";
        watchedList.innerHTML = watchedMovies
          .map(
            (movie) => `
                <div class="watched-item">
                    <img src="${
                      movie.poster_path
                        ? IMG_BASE_URL + movie.poster_path
                        : "https://via.placeholder.com/120x180"
                    }" 
                         alt="${movie.title}"
                         onclick="showMovieDetails(${
                           movie.id
                         }, '${movie.title.replace(/'/g, "\\'")}')">
                    <button class="remove-btn" onclick="removeFromLibrary(${
                      movie.id
                    }); event.stopPropagation();">Remove</button>
                </div>
            `
          )
          .join("");
      }

      // Remove from library
      function removeFromLibrary(movieId) {
        watchedMovies = watchedMovies.filter((m) => m.id !== movieId);
        localStorage.setItem("watchedMovies", JSON.stringify(watchedMovies));
        updateWatchedList();
      }

      // Loading states
      function showLoading(loadingId) {
        document.getElementById(loadingId).classList.add("active");
      }

      function hideLoading(loadingId) {
        document.getElementById(loadingId).classList.remove("active");
      }

      // Initialize with popular movies
      window.addEventListener("load", () => {
        applyFilters();
      });

      // Close modal on outside click
      window.addEventListener("click", (e) => {
        const modal = document.getElementById("movieModal");
        if (e.target === modal) {
          closeModal();
        }
      });
    </script>
  </body>
</html>
